# Source

The source is a simple [main.c](src/main.c) in `src` directory.

Upon pressing the PIN 14 or PIN 24 (USR key) and sending character `A` to authenticate, the program is printing the decrypted flag.

# Compiling

Compile the project with the Pico SDK. Use the [CMakeLists.txt](CMakeLists.txt).

The output files should be in the `build` directory: `main.elf`, `main.bin`, `main.uf2`.

# Generating the flag

Choose a 32 byte long string as flag.

```
DB{4cc3400aa0adf4d2b38d57810e1a}
```

The flag can be generated by enabling the logic in `decrypt()`. It is a sliding xor with starting key `"\x08\xd0\xa6\x80"`.

```c
char a[4096] = "DB{4cc3400aa0adf4d2b38d57810e1a}";
address = (uint8_t*)a;
for (size_t i=0;i<sizeof(buff);i++)
{
    size_t j = i % sizeof(xorkey);
    buff[i] = address[i] ^ xorkey[j];
    xorkey[j] = address[i];
    printf("%02x",buff[i]);
}
```

Save the flag as binary file in the [flag/flag_enc.bin](flag/flag_enc.bin).

# Flashing

Nuke the flash with [flash_nuke.uf2](../../extras/flash_nuke.uf2) to clear previous data if applicable.

```bash
picotool load -x flash_nuke.uf2
```

Install the [main.bin](build/main.bin) from build directory.

```bash
picotool load build/main.bin
```

Add the [flag_aes.bin](flag/flag_aes.bin) created earlier.

```bash
picotool load -o 0x101ff000 flag/flag_enc.bin
```

# Saving everything
Exporting the full flash with padding and flag. Change the address if more of the flash storage was utilized earlier.

```bash
picotool info -a
picotool save -r 0x10000000 0x10200000 challenge2.uf2
```